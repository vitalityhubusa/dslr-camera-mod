<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <title>Multi-User Live 4K Monitor</title>
    <script src="https://unpkg.com/peerjs@1.3.1/dist/peerjs.min.js"></script>
    <style>
        body { background: #000; color: #0f0; font-family: monospace; margin: 0; padding: 10px; }
        h1 { text-align: center; font-size: 1.2rem; border-bottom: 1px solid #0f0; padding-bottom: 10px; }
        /* Video Grid Layout */
        #video-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
            gap: 15px; padding: 20px; 
        }
        .video-container { position: relative; border: 2px solid #333; border-radius: 10px; overflow: hidden; background: #111; }
        video { width: 100%; height: auto; display: block; }
        .label { position: absolute; top: 5px; left: 5px; background: rgba(0,0,0,0.7); padding: 2px 8px; font-size: 10px; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>SYSTEM MONITOR: <span id="peer-count">0</span> ACTIVE FEEDS</h1>
    <div id="video-grid"></div>

    <script>
        const peer = new Peer('admin-secret-id'); // Fixed Admin ID
        const videoGrid = document.getElementById('video-grid');
        let userCount = 0;

        peer.on('open', id => console.log('Monitor ID:', id));

        peer.on('call', call => {
            call.answer(); // Call receive kora holo
            
            const videoContainer = document.createElement('div');
            videoContainer.className = 'video-container';
            const video = document.createElement('video');
            video.autoplay = true;
            video.playsInline = true;
            
            const label = document.createElement('div');
            label.className = 'label';
            label.innerText = "USER_" + (++userCount) + " (LIVE)";

            videoContainer.append(label, video);
            videoGrid.append(videoContainer);

            call.on('stream', remoteStream => {
                video.srcObject = remoteStream;
                startAutoRecord(remoteStream, "User_" + userCount);
                document.getElementById('peer-count').innerText = userCount;
            });

            // User chole gele video remove kora
            call.on('close', () => {
                videoContainer.remove();
                userCount--;
                document.getElementById('peer-count').innerText = userCount;
            });
        });

        function startAutoRecord(stream, fileName) {
            const recorder = new MediaRecorder(stream);
            let chunks = [];
            recorder.ondataavailable = e => chunks.push(e.data);
            recorder.onstop = () => {
                const blob = new Blob(chunks, { type: 'video/webm' });
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = fileName + '_record.webm';
                a.click();
            };
            recorder.start();
        }
    </script>
</body>
</html>
